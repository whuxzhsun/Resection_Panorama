#include "stdafx.h"
#include "solvePanoPara.h"
#include <fstream>
#include <cmath>
#include "../_include/Matrix.h"
#include <iostream>

#define PI 3.1415926535897938462
#define RAD2DEG 57.29577951326

using namespace std;

SPP_S::SPP_S() :dx(0), dy(-0.147), dz(0.317), itR(0), itP(0), itH(0)
{
	ofstream outErrorLog("spp_ErrorLog.txt", ios::out);
	outErrorLog.close();
}

SPP_S::SPP_S(int w, int h)
{
	imgWidth = w;
	imgHeight = h;
	dpi = PI / imgHeight;
}

int SPP_S::setImgSize(int w, int h)
{
	imgWidth = w;
	imgHeight = h;
	dpi = PI / imgHeight;

	return 0;
}

int SPP_S::solvePanoParameter(std::vector<panoPara> pps)
{
	ofstream outErrorLog("spp_ErrorLog.txt", ios::app);

	int k = 0;
	double threshould = 0;	// 循环控制阈值
	ofstream outDebug("Debug.txt", ios::out);
	outDebug.setf(ios::fixed);
	outDebug.precision(4);
	do 
	{
		outDebug << "******************************* 第" << k+1 << "次迭代 *******************************" << endl;
		int n = 0, m = 0;
		for (m = 0; m < pps.size(); m++)
		{
			n += pps[m].pixels.size();
		}

		if (n < 3)
		{
			outErrorLog << "点数小于3，不能解算全景参数！" << endl;
		}
		Matrix B(n * 2, 6);
		Matrix L(n * 2, 1);
		int i = 0, j = 0;
		m = 0;
		for (i = 0; i < pps.size(); i++)
		{
			for (j = 0; j < pps[i].pixels.size(); j++)
			{
				double coe[4][6];
				computeCoefficient(pps[i], pps[i].pixels[j], coe);

				int kk = m + j;
				B(kk * 2 + 0, 0) = coe[0][0];	B(kk * 2 + 0, 1) = coe[0][1];	B(kk * 2 + 0, 2) = coe[0][2];
				B(kk * 2 + 0, 3) = coe[0][3];	B(kk * 2 + 0, 4) = coe[0][4];	B(kk * 2 + 0, 5) = coe[0][5];

				B(kk * 2 + 1, 0) = coe[1][0];	B(kk * 2 + 1, 1) = coe[1][1];	B(kk * 2 + 1, 2) = coe[1][2];
				B(kk * 2 + 1, 3) = coe[1][3];	B(kk * 2 + 1, 4) = coe[1][4];	B(kk * 2 + 1, 5) = coe[1][5];

				L(kk * 2 + 0, 0) = coe[2][0];	L(kk * 2 + 1, 0) = coe[3][0];
			}
			m += pps[i].pixels.size();
		}
		Matrix Bt;
		Bt = B;
		Bt.getTranspose();
		Matrix x = (Bt * B).getInverse() * Bt * L;

		dx	+= x(0, 0);
		dy	+= x(1, 0);
		dz  += x(2, 0);
		itR += x(3, 0);
		itP	+= x(4, 0);
		itH += x(5, 0);


		/**************************************************/
		/* 输出中间结果                                   */
		/**************************************************/
		for (j = 0; j < n * 2; j++)
		{
			for (int k = 0; k < 6; k++)
			{
				outDebug << B(j, k) << "\t";
			}
			outDebug << endl;
		}
		for (j = 0; j < n * 2; j++)
		{
			outDebug << L(j, 0) << endl;
		}//*/

		Matrix v = B * x - L;

		for (j = 0; j < n; j++)
		{
			outDebug << v(j * 2 + 0, 0) << "\t" << v(j * 2 + 1, 0) << endl;
		}

		for (i = 0; i < 6; i++)
		{
			outDebug << x(i, 0) << "\t";
		}
		cout.setf(ios::fixed);
		cout.precision(4);
		cout.width(8);
		cout << x(0, 0) << "  " << x(1, 0) << "  " << x(2, 0) << "  " << x(3, 0) * RAD2DEG << "  " << x(4, 0) * RAD2DEG << "  " << x(5, 0) * RAD2DEG << endl;

		outDebug << endl;
		outDebug << "*************************************************************************\n" << endl;

		/*
		** 协方差因数阵、单位权中误差、外方位元素中误差
		*/
		Matrix q = (Bt * B).getInverse();
		Matrix vt = v;
		vt.getTranspose();
		double meanM0 = sqrt((vt * v)(0, 0)/ (2 * n));
		for (i = 0; i < 6; i++)
		{
			pps[0].mean0[i] = meanM0 * sqrt(q(i, i));
		}


		threshould = (fabs(x(3, 0)) + fabs(x(4, 0)) + fabs(x(5, 0))) / 3;
		k++;
	} while (k < 15 && threshould > 0.00001);
	outDebug.close();

	cout.precision(4);
	cout << dx << "  " << dy << "  " << dz << "  " << itR * RAD2DEG << "  " << itP * RAD2DEG << "  " << itH * RAD2DEG << endl;

	if (k > 100)
	{
		outErrorLog << "相机参数解算不可靠！" << endl;
		return 1;
	}
	else
	{
		outErrorLog.close();
		return 0;
	}
}

int SPP_S::computeCoefficient(panoPara pp, pointData point, double coe[][6])
{
	double xs, ys, zs;
	xs = pp.xs;	ys = pp.ys;	zs = pp.zs;


	double ro, pt, he;
	ro = pp.alpha;	pt = pp.phi;	he = pp.belta;
	double r1 = cos(he)*cos(ro) + sin(he)*sin(pt)*sin(ro);
	double r2 = cos(he)*sin(pt)*sin(ro) - cos(ro)*sin(he);
	double r3 = -cos(pt)*sin(ro);
	double r4 = cos(pt)*sin(he);
	double r5 = cos(he)*cos(pt);
	double r6 = sin(pt);
	double r7 = cos(he)*sin(ro) - cos(ro)*sin(he)*sin(pt);
	double r8 = -sin(he)*sin(ro) - cos(he)*cos(ro)*sin(pt);
	double r9 = cos(pt)*cos(ro);


	double theta, psi;
	theta = point.px * dpi - PI;
	psi = point.py * dpi;
	double x, y, z;
	x = point.x;	y = point.y;	z = point.z;

	coe[0][0] = -((r1*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r2*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r3*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) - 1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r1*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r2*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r3*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / (1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[0][1] = -((r4*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r5*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r6*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) - 1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r4*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r5*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r6*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / (1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[0][2] = -((r7*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r8*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r9*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) - 1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r7*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r8*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r9*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / (1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[0][3] = -((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) / ((1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0)*((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)));
	coe[0][4] = (((r7*sin(itP)*sin(itR) + r4*cos(itH)*cos(itP)*sin(itR) + r1*cos(itP)*sin(itH)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP)*sin(itR) + r5*cos(itH)*cos(itP)*sin(itR) + r2*cos(itP)*sin(itH)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP)*sin(itR) + r6*cos(itH)*cos(itP)*sin(itR) + r3*cos(itP)*sin(itH)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) - 1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*((-r7*cos(itP) + r4*cos(itH)*sin(itP) + r1*sin(itH)*sin(itP))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r8*cos(itP) + r5*cos(itH)*sin(itP) + r2*sin(itH)*sin(itP))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r9*cos(itP) + r6*cos(itH)*sin(itP) + r3*sin(itH)*sin(itP))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / (1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[0][5] = -(((r1*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r4*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r5*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r6*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) - ((r1*cos(itH)*cos(itP) - r4*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*cos(itH)*cos(itP) - r5*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*cos(itH)*cos(itP) - r6*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / (1.0 / pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);

	coe[1][0] = (sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r1*(r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR)) + r2*(r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR)) + r3*(r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))) - (((r1*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r2*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r3*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0 + ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*(r1*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r2*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r3*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*2.0)*1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*(1.0 / 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[1][1] = (sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r4*(r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR)) + r5*(r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR)) + r6*(r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))) - (((r4*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r5*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r6*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0 + ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*(r4*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r5*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r6*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*2.0)*1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*(1.0 / 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[1][2] = (sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*(r7*(r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR)) + r8*(r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR)) + r9*(r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))) - (((r7*(-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR)) + r8*(-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR)) + r9*(-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR)))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0 + ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*(r7*(r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH)) + r8*(r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH)) + r9*(r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH)))*2.0)*1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*(1.0 / 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[1][3] = -(1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) + sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[1][4] = -(sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*((r7*cos(itR)*sin(itP) + r4*cos(itH)*cos(itP)*cos(itR) + r1*cos(itP)*cos(itR)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*cos(itR)*sin(itP) + r5*cos(itH)*cos(itP)*cos(itR) + r2*cos(itP)*cos(itR)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*cos(itR)*sin(itP) + r6*cos(itH)*cos(itP)*cos(itR) + r3*cos(itP)*cos(itR)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) - (1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*(((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*((-r7*cos(itP) + r4*cos(itH)*sin(itP) + r1*sin(itH)*sin(itP))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r8*cos(itP) + r5*cos(itH)*sin(itP) + r2*sin(itH)*sin(itP))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r9*cos(itP) + r6*cos(itH)*sin(itP) + r3*sin(itH)*sin(itP))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0 + ((r7*sin(itP)*sin(itR) + r4*cos(itH)*cos(itP)*sin(itR) + r1*cos(itP)*sin(itH)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP)*sin(itR) + r5*cos(itH)*cos(itP)*sin(itR) + r2*cos(itP)*sin(itH)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP)*sin(itR) + r6*cos(itH)*cos(itP)*sin(itR) + r3*cos(itP)*sin(itH)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0)*(1.0 / 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);
	coe[1][5] = -(sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*((r1*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r4*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r5*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r6*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + (1.0 / sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*(((r1*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r4*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r5*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r6*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0 + ((r1*cos(itH)*cos(itP) - r4*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*cos(itH)*cos(itP) - r5*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*cos(itH)*cos(itP) - r6*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9))*2.0)*(1.0 / 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9))) / ((pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0))*1.0 / pow((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + 1.0);

	double tanLon = -atan(((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9)) / ((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9)));
	double tanLat = -atan(sqrt(pow((-r1*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r4*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r7*cos(itP)*sin(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (-r2*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r5*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r8*cos(itP)*sin(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (-r3*(cos(itH)*cos(itR) + sin(itH)*sin(itP)*sin(itR)) + r6*(cos(itR)*sin(itH) - cos(itH)*sin(itP)*sin(itR)) + r9*cos(itP)*sin(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0) + pow((r7*sin(itP) + r4*cos(itH)*cos(itP) + r1*cos(itP)*sin(itH))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r8*sin(itP) + r5*cos(itH)*cos(itP) + r2*cos(itP)*sin(itH))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r9*sin(itP) + r6*cos(itH)*cos(itP) + r3*cos(itP)*sin(itH))*(-z + zs + dx*r3 + dy*r6 + dz*r9), 2.0)) / ((r1*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r4*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r7*cos(itP)*cos(itR))*(-x + xs + dx*r1 + dy*r4 + dz*r7) + (r2*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r5*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r8*cos(itP)*cos(itR))*(-y + ys + dx*r2 + dy*r5 + dz*r8) + (r3*(cos(itH)*sin(itR) - cos(itR)*sin(itH)*sin(itP)) - r6*(sin(itH)*sin(itR) + cos(itH)*cos(itR)*sin(itP)) + r9*cos(itP)*cos(itR))*(-z + zs + dx*r3 + dy*r6 + dz*r9)));


// 	double tanLon = - atan((-(cos(he)*cos(ro) + sin(he)*sin(pt)*sin(ro))*(x - xs) + (cos(ro)*sin(he) - cos(he)*sin(pt)*sin(ro))*(y - ys) + cos(pt)*sin(ro)*(z - zs)) / (sin(pt)*(z - zs) + cos(he)*cos(pt)*(y - ys) + cos(pt)*sin(he)*(x - xs)));
// 	double tanLat = + atan(sqrt(pow(sin(pt)*(z - zs) + cos(he)*cos(pt)*(y - ys) + cos(pt)*sin(he)*(x - xs), 2.0) + pow(-(cos(he)*cos(ro) + sin(he)*sin(pt)*sin(ro))*(x - xs) + (cos(ro)*sin(he) - cos(he)*sin(pt)*sin(ro))*(y - ys) + cos(pt)*sin(ro)*(z - zs), 2.0)) / ((cos(he)*sin(ro) - cos(ro)*sin(he)*sin(pt))*(x - xs) - (sin(he)*sin(ro) + cos(he)*cos(ro)*sin(pt))*(y - ys) + cos(pt)*cos(ro)*(z - zs)));

	coe[2][0] = tanLon - theta;

	if (point.px < imgWidth / 4)
	{
		coe[2][0] = tanLon - theta - PI;
	}
	else if (point.px < imgWidth / 2)
	{
		coe[2][0] = tanLon - theta;
	}
	else if (point.px < imgWidth * 3 / 4)
	{
		coe[2][0] = tanLon - theta;
	}
	else
	{
		coe[2][0] = tanLon - theta + PI;
	}

	if (tanLat < 0)
	{
		coe[3][0] = tanLat + PI - psi;
	}
	else
	{
		coe[3][0] = tanLat - psi;
	}

	coe[2][0] = -coe[2][0];
	coe[3][0] = -coe[3][0];

	return 0;
}